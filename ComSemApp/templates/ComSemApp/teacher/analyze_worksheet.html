{% extends 'ComSemApp/sidebar.html' %}

{% block content %}

<div class="row">
	<div class="col-sm-12">
		<div class="page-title-box">
			<h4 class="page-title">Analyze Worksheet</h4>
			<div class="clearfix"></div>
		</div>
	</div>
</div>

<div class="row">
	<!-- course info -->
	<div class="col-lg-5 col-md-5 col-sm-4">
		{% include 'ComSemApp/worksheet_details.html' %}
	</div>
</div>

<div class="row">
	<div class="col-sm-6">
		<!-- Worksheet contents -->
		<div class="portlet" style="min-height:400pxs;max-height-400px; overflow-y:scroll">

			<div class="portlet-heading portlet-default">
				<h4 class="portlet-title m-t-0 header-title"><b>Worksheet Expressions</b></h4>
			</div>

			<div id="worksheetExpressionsPortlet" class="panel-collapse collapse show">
				<div class="portlet-body">

					<table id="expressionTable" class="table table-hover table-sm">
						<thead>
							<tr>
								<th>#</th>
								<th>All-Do</th>
								<th>Student</th>
								<th>Expression</th>
								<th>Analyzed</th>
								<th>Show/Hide</th>
							</tr>
						</thead>
						<tbody>
							{% for expression in worksheet.expressions.all %}
								<tr>
									<td>{{ forloop.counter }}</td>
									<td>
										{% if expression.all_do %}
											<i class='fa fa-check'></i>
										{% endif %}
									</td>
									<td>
										{% if expression.student %}
											{{ expression.student }}
										{% else %}
											<b></b>anon.</b>
										{% endif %}
									</td>
									<td>
										{{ expression.expression }}
									</td>
									<td>
									</td>
									<td>
										<button class='btn btn-sm btn-outline-primary analyzeExpression' url="{% url 'teacher:analyze_expression' course_id=course.id worksheet_id=worksheet.id expression_id=expression.id %}">
											<i class='fa fa-pencil-square-o'></i>
										</button>
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>

				</div>
			</div>
		</div>
			
	</div>

	<div class="col-sm-6">
		<!-- Worksheet contents -->
		<div class="portlet" style="min-height:400pxs; overflow-y:scroll">

			<div class="portlet-heading portlet-default">
				<h4 class="portlet-title m-t-0 header-title"><b>Expression Analysis</b></h4>
			</div>

			<div id="worksheetExpressionsPortlet" class="panel-collapse collapse show">
				<div class="portlet-body">
					<b>Instructions</b>
					<ol>
						<li>Select an expression from the list on the left</li>
						<li>Highlight the word, phrase, or clause in the expression that contains the error</li>
						<li>Using the drop-down menus, select and an error category (and optionally, a subcategory)</li>
						<li>Click "Save analysis"</li>
					</ol>
					
					<div id="analysis_form"></div>
				</div>
			</div>
		</div>
			
	</div>
</div>

<script>
    $(function(){
		function populateEditor(url) {
			$("#analysis_form").load(url)
		}
        // bind edit button to its function
        $('.analyzeExpression').on('click', function(e){
            $('#expressionTable tr').removeClass('cs-active');
            $(this).parents('tr').addClass('cs-active');
            populateEditor($(this).attr('url'));
            audioReformulationBlob = null; // clears reformulation
        });
	})
</script>


{% endblock %}